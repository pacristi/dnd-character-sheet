<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ficha de Personaje D&D 5e</title>
    <link rel="stylesheet" href="./css/styles.css" />
    <link rel="stylesheet" href="./css/nav-bar.css" />
    <link rel="icon" type="image/png" href="./images/d20-icon.png" />
    <meta
      name="description"
      content="Hoja de personaje interactiva para D&D 5ª Edición"
    />
  </head>
  <body>
    <!-- Top Navigation Bar -->
    <nav class="top-navbar">
      <div class="nav-container">
        <div class="nav-logo">D&D 5E</div>
        <ul class="nav-links">
          <li class="active"><a href="index.html">Ficha de Personaje</a></li>
          <li><a href="session-notes.html">Notas de Sesión</a></li>
        </ul>
      </div>
    </nav>

    <div class="main-container">
      <!-- Character portrait container -->
      <div class="character-portrait-container">
        <div class="character-portrait-sticky">
          <div class="character-portrait">
            <img
              id="character-image"
              src="./images/default-character.png"
              alt="Imagen del personaje"
            />
            <div class="portrait-controls">
              <label for="upload-portrait" class="upload-btn"
                >Cambiar imagen</label
              >
              <input
                type="file"
                id="upload-portrait"
                accept="image/*"
                class="file-input"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Main content container -->
      <div class="main-content">
        <div class="header">
          <h1>D&D 5ª Edición</h1>
          <p class="character-title">Ficha de Personaje</p>
        </div>

        <!-- Basic Information Section -->
        <div class="section">
          <h2>Información Básica</h2>
          <div class="basic-info">
            <div class="info-item">
              <label for="character-name">Nombre:</label>
              <input
                type="text"
                id="character-name"
                placeholder="Nombre de tu personaje"
                aria-label="Nombre del personaje"
              />
            </div>
            <div class="info-item">
              <label for="level">Nivel:</label>
              <div class="counter-container">
                <button
                  type="button"
                  class="counter-button"
                  aria-label="Disminuir nivel"
                  onclick="adjustCounter('level', -1)"
                >
                  -
                </button>
                <span id="level" class="counter-value" aria-live="polite"
                  >1</span
                >
                <button
                  type="button"
                  class="counter-button"
                  aria-label="Aumentar nivel"
                  onclick="adjustCounter('level', 1)"
                >
                  +
                </button>
              </div>
            </div>
            <div class="info-item">
              <label for="race">Raza:</label>
              <input
                type="text"
                id="race"
                placeholder="Raza"
                aria-label="Raza del personaje"
              />
            </div>
            <div class="info-item">
              <label for="class">Clase:</label>
              <input
                type="text"
                id="class"
                placeholder="Clase"
                aria-label="Clase del personaje"
              />
            </div>
            <div class="info-item">
              <label for="background">Trasfondo:</label>
              <input
                type="text"
                id="background"
                placeholder="Trasfondo"
                aria-label="Trasfondo del personaje"
              />
            </div>
            <div class="info-item">
              <label for="alignment">Alineamiento:</label>
              <input
                type="text"
                id="alignment"
                placeholder="Alineamiento"
                aria-label="Alineamiento del personaje"
              />
            </div>
          </div>
        </div>

        <!-- Abilities Section -->
        <div class="section">
          <h2>Características</h2>
          <div class="abilities">
            <div class="ability" data-ability="str">
              <div class="ability-name">FUERZA</div>
              <input
                type="number"
                class="ability-score"
                value="10"
                min="1"
                max="30"
                aria-label="Puntuación de Fuerza"
                onchange="updateAbilityMod(this)"
              />
              <div class="ability-mod" aria-live="polite">+0</div>
            </div>
            <div class="ability" data-ability="dex">
              <div class="ability-name">DESTREZA</div>
              <input
                type="number"
                class="ability-score"
                value="10"
                min="1"
                max="30"
                aria-label="Puntuación de Destreza"
                onchange="updateAbilityMod(this)"
              />
              <div class="ability-mod" aria-live="polite">+0</div>
            </div>
            <div class="ability" data-ability="con">
              <div class="ability-name">CONSTITUCIÓN</div>
              <input
                type="number"
                class="ability-score"
                value="10"
                min="1"
                max="30"
                aria-label="Puntuación de Constitución"
                onchange="updateAbilityMod(this)"
              />
              <div class="ability-mod" aria-live="polite">+0</div>
            </div>
            <div class="ability" data-ability="int">
              <div class="ability-name">INTELIGENCIA</div>
              <input
                type="number"
                class="ability-score"
                value="10"
                min="1"
                max="30"
                aria-label="Puntuación de Inteligencia"
                onchange="updateAbilityMod(this)"
              />
              <div class="ability-mod" aria-live="polite">+0</div>
            </div>
            <div class="ability" data-ability="wis">
              <div class="ability-name">SABIDURÍA</div>
              <input
                type="number"
                class="ability-score"
                value="10"
                min="1"
                max="30"
                aria-label="Puntuación de Sabiduría"
                onchange="updateAbilityMod(this)"
              />
              <div class="ability-mod" aria-live="polite">+0</div>
            </div>
            <div class="ability" data-ability="cha">
              <div class="ability-name">CARISMA</div>
              <input
                type="number"
                class="ability-score"
                value="10"
                min="1"
                max="30"
                aria-label="Puntuación de Carisma"
                onchange="updateAbilityMod(this)"
              />
              <div class="ability-mod" aria-live="polite">+0</div>
            </div>
          </div>
        </div>

        <!-- Combat Stats Section -->
        <div class="section">
          <h2>Estadísticas de Combate</h2>
          <div class="combat-stats">
            <div class="combat-stat">
              <div class="combat-stat-name">CLASE DE ARMADURA</div>
              <input
                type="number"
                id="armor-class"
                class="combat-stat-value"
                value="10"
                min="0"
                aria-label="Clase de Armadura"
              />
            </div>
            <div class="combat-stat">
              <div class="combat-stat-name">INICIATIVA</div>
              <input
                type="number"
                id="initiative"
                class="combat-stat-value"
                value="0"
                aria-label="Iniciativa"
              />
            </div>
            <div class="combat-stat">
              <div class="combat-stat-name">VELOCIDAD</div>
              <input
                type="text"
                id="speed"
                class="combat-stat-value"
                value="9m"
                aria-label="Velocidad"
              />
            </div>
            <div class="combat-stat">
              <div class="combat-stat-name">PUNTOS DE VIDA</div>
              <div class="hp-container">
                <input
                  type="number"
                  id="current-hp"
                  class="hp-current"
                  value="10"
                  min="0"
                  aria-label="Puntos de vida actuales"
                />
                /
                <input
                  type="number"
                  id="max-hp"
                  class="hp-current"
                  value="10"
                  min="1"
                  aria-label="Puntos de vida máximos"
                />
              </div>
              <div class="combat-stat-name">PUNTOS DE VIDA TEMPORALES</div>
              <div class="hp-container">
                <input
                  type="number"
                  id="current-hp"
                  class="hp-current"
                  value="0"
                  min="0"
                  aria-label="Puntos de vida actuales"
                />
              </div>
            </div>
          </div>

          <h3>Tiradas de Salvación</h3>
          <div class="skills" id="saving-throws">
            <div class="skill-item" data-skill="str-save">
              <div
                class="proficient"
                role="checkbox"
                aria-checked="false"
                tabindex="0"
                onclick="toggleProficiency(this)"
                onkeypress="if(event.key==='Enter'||event.key===' ')toggleProficiency(this)"
              ></div>
              <span>Fuerza</span>
              <span class="skill-mod" aria-live="polite">+0</span>
            </div>
            <div class="skill-item" data-skill="dex-save">
              <div
                class="proficient"
                role="checkbox"
                aria-checked="false"
                tabindex="0"
                onclick="toggleProficiency(this)"
                onkeypress="if(event.key==='Enter'||event.key===' ')toggleProficiency(this)"
              ></div>
              <span>Destreza</span>
              <span class="skill-mod" aria-live="polite">+0</span>
            </div>
            <div class="skill-item" data-skill="con-save">
              <div
                class="proficient"
                role="checkbox"
                aria-checked="false"
                tabindex="0"
                onclick="toggleProficiency(this)"
                onkeypress="if(event.key==='Enter'||event.key===' ')toggleProficiency(this)"
              ></div>
              <span>Constitución</span>
              <span class="skill-mod" aria-live="polite">+0</span>
            </div>
            <div class="skill-item" data-skill="int-save">
              <div
                class="proficient"
                role="checkbox"
                aria-checked="false"
                tabindex="0"
                onclick="toggleProficiency(this)"
                onkeypress="if(event.key==='Enter'||event.key===' ')toggleProficiency(this)"
              ></div>
              <span>Inteligencia</span>
              <span class="skill-mod" aria-live="polite">+0</span>
            </div>
            <div class="skill-item" data-skill="wis-save">
              <div
                class="proficient"
                role="checkbox"
                aria-checked="false"
                tabindex="0"
                onclick="toggleProficiency(this)"
                onkeypress="if(event.key==='Enter'||event.key===' ')toggleProficiency(this)"
              ></div>
              <span>Sabiduría</span>
              <span class="skill-mod" aria-live="polite">+0</span>
            </div>
            <div class="skill-item" data-skill="cha-save">
              <div
                class="proficient"
                role="checkbox"
                aria-checked="false"
                tabindex="0"
                onclick="toggleProficiency(this)"
                onkeypress="if(event.key==='Enter'||event.key===' ')toggleProficiency(this)"
              ></div>
              <span>Carisma</span>
              <span class="skill-mod" aria-live="polite">+0</span>
            </div>
          </div>
        </div>

        <!-- Skills Section -->
        <div class="section">
          <h2>Pericias</h2>
          <div class="skills" id="skills-list">
            <!-- Skills will be loaded from JS -->
          </div>
        </div>

        <!-- Features Section -->
        <div class="section">
          <h2>Rasgos y Habilidades</h2>
          <div id="features-container">
            <!-- Features will be loaded from JS -->
          </div>
          <button type="button" onclick="addFeature()" style="margin-top: 10px">
            Añadir Rasgo
          </button>
        </div>

        <!-- Spells Section -->
        <div class="section">
          <h2>Hechizos</h2>
          <div id="spells-container">
            <!-- Spells will be loaded from JS -->
          </div>

          <div class="spell-add" style="margin-top: 15px">
            <div class="spell-add-row">
              <input
                type="text"
                id="new-spell"
                placeholder="Añadir nuevo hechizo"
                aria-label="Nombre del hechizo"
              />
              <select id="spell-level-select" aria-label="Nivel del hechizo">
                <option value="cantrip">Truco</option>
                <option value="1">Nivel 1</option>
                <option value="2">Nivel 2</option>
                <option value="3">Nivel 3</option>
                <option value="4">Nivel 4</option>
                <option value="5">Nivel 5</option>
                <option value="6">Nivel 6</option>
                <option value="7">Nivel 7</option>
                <option value="8">Nivel 8</option>
                <option value="9">Nivel 9</option>
              </select>
            </div>

            <div class="spell-add-row">
              <input
                type="text"
                id="new-spell-cast-time"
                placeholder="Tiempo de lanzamiento"
                aria-label="Tiempo de lanzamiento"
              />
              <input
                type="text"
                id="new-spell-range"
                placeholder="Alcance"
                aria-label="Alcance del hechizo"
              />
              <input
                type="text"
                id="new-spell-duration"
                placeholder="Duración"
                aria-label="Duración del hechizo"
              />
            </div>

            <div class="spell-add-row">
              <input
                type="text"
                id="new-spell-components"
                placeholder="Componentes (V, S, M)"
                aria-label="Componentes del hechizo"
              />
              <select id="new-spell-school" aria-label="Escuela de magia">
                <option value="Abjuración">Abjuración</option>
                <option value="Adivinación">Adivinación</option>
                <option value="Conjuración">Conjuración</option>
                <option value="Encantamiento">Encantamiento</option>
                <option value="Evocación">Evocación</option>
                <option value="Ilusión">Ilusión</option>
                <option value="Nigromancia">Nigromancia</option>
                <option value="Transmutación">Transmutación</option>
              </select>
            </div>

            <textarea
              id="new-spell-description"
              placeholder="Descripción del hechizo"
              rows="4"
              aria-label="Descripción del hechizo"
            ></textarea>

            <div class="spell-add-buttons">
              <button type="button" onclick="addSpell()">Añadir Hechizo</button>
              <button
                type="button"
                onclick="searchSpellDatabase()"
                class="secondary-button"
              >
                Buscar Hechizo
              </button>
            </div>
          </div>

          <!-- Spell Detail Modal -->
          <div
            id="spell-detail-modal"
            class="modal"
            role="dialog"
            aria-labelledby="modal-spell-name"
            aria-hidden="true"
          >
            <div class="modal-content">
              <span
                class="close-button"
                onclick="closeSpellModal()"
                aria-label="Cerrar"
                >&times;</span
              >
              <h3 id="modal-spell-name">Nombre del Hechizo</h3>
              <div class="spell-info-grid">
                <div class="spell-info-item">
                  <span class="spell-info-label">Nivel:</span>
                  <span id="modal-spell-level">Nivel</span>
                </div>
                <div class="spell-info-item">
                  <span class="spell-info-label">Escuela:</span>
                  <span id="modal-spell-school">Escuela</span>
                </div>
                <div class="spell-info-item">
                  <span class="spell-info-label">Tiempo:</span>
                  <span id="modal-spell-time">Tiempo</span>
                </div>
                <div class="spell-info-item">
                  <span class="spell-info-label">Alcance:</span>
                  <span id="modal-spell-range">Alcance</span>
                </div>
                <div class="spell-info-item">
                  <span class="spell-info-label">Duración:</span>
                  <span id="modal-spell-duration">Duración</span>
                </div>
                <div class="spell-info-item">
                  <span class="spell-info-label">Componentes:</span>
                  <span id="modal-spell-components">Componentes</span>
                </div>
              </div>
              <div class="spell-description">
                <p id="modal-spell-description">Descripción del hechizo.</p>
              </div>
              <div class="modal-buttons">
                <button type="button" onclick="editSpellInModal()">
                  Editar
                </button>
                <button
                  type="button"
                  onclick="closeSpellModal()"
                  class="secondary-button"
                >
                  Cerrar
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Attacks Section -->
        <div class="section">
          <h2>Ataques y Armas</h2>
          <div class="attacks-header">
            <div class="attack-col-name">Nombre</div>
            <div class="attack-col-bonus">Bonificador</div>
            <div class="attack-col-damage">Daño</div>
            <div class="attack-col-type">Tipo</div>
            <div class="attack-col-range">Alcance</div>
            <div class="attack-col-properties">Propiedades</div>
            <div class="attack-col-actions"></div>
          </div>
          <div id="attacks-list">
            <!-- Attacks will be loaded from JS -->
          </div>
          <div class="attack-add">
            <input
              type="text"
              id="new-attack-name"
              placeholder="Nombre"
              aria-label="Nombre del ataque"
            />
            <input
              type="text"
              id="new-attack-bonus"
              placeholder="+0"
              style="width: 60px"
              aria-label="Bonificador de ataque"
            />
            <input
              type="text"
              id="new-attack-damage"
              placeholder="1d8"
              style="width: 80px"
              aria-label="Daño del ataque"
            />
            <select id="new-attack-type" aria-label="Tipo de daño">
              <option value="cortante">Cortante</option>
              <option value="perforante">Perforante</option>
              <option value="contundente">Contundente</option>
              <option value="ácido">Ácido</option>
              <option value="frío">Frío</option>
              <option value="fuego">Fuego</option>
              <option value="fuerza">Fuerza</option>
              <option value="eléctrico">Eléctrico</option>
              <option value="necrótico">Necrótico</option>
              <option value="psíquico">Psíquico</option>
              <option value="radiante">Radiante</option>
              <option value="trueno">Trueno</option>
              <option value="veneno">Veneno</option>
            </select>
            <input
              type="text"
              id="new-attack-range"
              placeholder="Alcance"
              style="width: 80px"
              aria-label="Alcance del ataque"
            />
            <input
              type="text"
              id="new-attack-properties"
              placeholder="Propiedades"
              aria-label="Propiedades del arma"
            />
            <button type="button" onclick="addAttack()">Añadir</button>
          </div>
        </div>

        <!-- Languages & Proficiencies Section -->
        <div class="section">
          <h2>Idiomas y Competencias</h2>
          <div>
            <div class="info-item">
              <label for="languages-list">Idiomas:</label>
              <div id="languages-container" style="margin-top: 5px">
                <div
                  id="languages-list"
                  style="
                    margin-bottom: 10px;
                    display: flex;
                    flex-wrap: wrap;
                    gap: 5px;
                  "
                >
                  <!-- Languages will be loaded from JS -->
                </div>
                <div style="display: flex; gap: 5px; margin-bottom: 10px">
                  <input
                    type="text"
                    id="new-language"
                    placeholder="Añadir idioma..."
                    style="flex-grow: 1"
                    aria-label="Nuevo idioma"
                  />
                  <button type="button" onclick="addLanguage()">Añadir</button>
                </div>
              </div>
            </div>

            <div class="info-item" style="margin-top: 15px">
              <label for="proficiencies-list">Otras Competencias:</label>
              <div id="proficiencies-container" style="margin-top: 5px">
                <div
                  id="proficiencies-list"
                  style="
                    margin-bottom: 10px;
                    display: flex;
                    flex-wrap: wrap;
                    gap: 5px;
                  "
                >
                  <!-- Proficiencies will be loaded from JS -->
                </div>
                <div style="display: flex; gap: 5px">
                  <input
                    type="text"
                    id="new-proficiency"
                    placeholder="Añadir competencia..."
                    style="flex-grow: 1"
                    aria-label="Nueva competencia"
                  />
                  <button type="button" onclick="addProficiency()">
                    Añadir
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Equipment Section -->
        <div class="section">
          <h2>Equipo</h2>
          <div id="equipment-list" class="equipment-list">
            <!-- Equipment will be loaded from JS -->
          </div>

          <div class="equipment-item" style="margin-top: 10px">
            <span>Monedas:</span>
            <input
              type="number"
              id="gold"
              value="0"
              min="0"
              style="width: 60px; margin: 0 5px"
              aria-label="Piezas de oro"
            />
            po
            <input
              type="number"
              id="silver"
              value="0"
              min="0"
              style="width: 60px; margin: 0 5px"
              aria-label="Piezas de plata"
            />
            pp
            <input
              type="number"
              id="copper"
              value="0"
              min="0"
              style="width: 60px; margin: 0 5px"
              aria-label="Piezas de cobre"
            />
            pc
          </div>

          <div class="equipment-add">
            <input
              type="text"
              id="new-equipment"
              placeholder="Añadir nuevo equipo"
              aria-label="Nuevo objeto"
            />
            <button type="button" onclick="addEquipment()">Añadir</button>
          </div>
        </div>

        <!-- Personality Traits Section -->
        <div class="section">
          <h2>Rasgos de Personalidad</h2>
          <div class="traits-section">
            <div>
              <div class="trait">
                <div class="trait-name">Personalidad</div>
                <textarea
                  id="personality-traits"
                  class="notes-box"
                  placeholder="Describe la personalidad de tu personaje"
                  aria-label="Rasgos de personalidad"
                ></textarea>
              </div>

              <div class="trait">
                <div class="trait-name">Ideal</div>
                <textarea
                  id="ideals"
                  class="notes-box"
                  placeholder="¿Cuáles son los ideales de tu personaje?"
                  aria-label="Ideales del personaje"
                ></textarea>
              </div>
            </div>

            <div>
              <div class="trait">
                <div class="trait-name">Vínculo</div>
                <textarea
                  id="bonds"
                  class="notes-box"
                  placeholder="¿Qué vínculos tiene tu personaje?"
                  aria-label="Vínculos del personaje"
                ></textarea>
              </div>

              <div class="trait">
                <div class="trait-name">Defecto</div>
                <textarea
                  id="flaws"
                  class="notes-box"
                  placeholder="¿Cuáles son los defectos de tu personaje?"
                  aria-label="Defectos del personaje"
                ></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Notes Section -->
        <div class="section">
          <h2>Notas</h2>
          <textarea
            id="notes"
            class="notes-box"
            style="width: 100%"
            placeholder="Notas adicionales de tu personaje y aventuras"
            aria-label="Notas"
          ></textarea>
        </div>

        <!-- Character Save/Load Section -->
        <div class="section">
          <h2>Cargar/Guardar Personaje</h2>
          <div style="display: flex; gap: 10px; margin-bottom: 10px">
            <button
              type="button"
              onclick="exportCharacterToJson()"
              style="flex: 1"
            >
              Guardar como JSON
            </button>
            <input
              type="file"
              id="import-json"
              class="file-input"
              accept=".json"
              aria-label="Importar personaje desde archivo JSON"
            />
            <button
              type="button"
              onclick="document.getElementById('import-json').click()"
              style="flex: 1"
            >
              Cargar desde JSON
            </button>
          </div>
        </div>

        <!-- Dice Roller Section -->
        <div class="section" id="dice-roller-section">
          <h2>Tirador de Dados</h2>
          <div class="dice-container">
            <div class="dice-options">
              <button
                type="button"
                onclick="rollDie(4)"
                class="dice-button"
                aria-label="Tirar d4"
              >
                d4
              </button>
              <button
                type="button"
                onclick="rollDie(6)"
                class="dice-button"
                aria-label="Tirar d6"
              >
                d6
              </button>
              <button
                type="button"
                onclick="rollDie(8)"
                class="dice-button"
                aria-label="Tirar d8"
              >
                d8
              </button>
              <button
                type="button"
                onclick="rollDie(10)"
                class="dice-button"
                aria-label="Tirar d10"
              >
                d10
              </button>
              <button
                type="button"
                onclick="rollDie(12)"
                class="dice-button"
                aria-label="Tirar d12"
              >
                d12
              </button>
              <button
                type="button"
                onclick="rollDie(20)"
                class="dice-button"
                aria-label="Tirar d20"
              >
                d20
              </button>
              <button
                type="button"
                onclick="rollDie(100)"
                class="dice-button"
                aria-label="Tirar d100"
              >
                d100
              </button>
            </div>
            <div class="custom-roll">
              <input
                type="number"
                id="dice-count"
                min="1"
                max="10"
                value="1"
                class="dice-input"
                aria-label="Número de dados"
              />
              <span>d</span>
              <select
                id="dice-type"
                class="dice-select"
                aria-label="Tipo de dado"
              >
                <option value="4">4</option>
                <option value="6">6</option>
                <option value="8">8</option>
                <option value="10">10</option>
                <option value="12">12</option>
                <option value="20" selected>20</option>
                <option value="100">100</option>
              </select>
              <button
                type="button"
                onclick="rollCustomDice()"
                class="dice-button"
                aria-label="Tirar dados custom"
              >
                Tirar dados
              </button>
              <input
                type="number"
                id="dice-modifier"
                value="0"
                class="dice-input"
                aria-label="Modificador"
              />
              <span>Modificador</span>
            </div>
            <div class="dice-result-container">
              <div
                id="dice-animation"
                class="dice-animation"
                aria-hidden="true"
              >
                <!-- Dice animation placeholder -->
              </div>
              <div id="dice-result" class="dice-result" aria-live="polite">
                Resultado: -
              </div>
              <div
                id="dice-details"
                class="dice-details"
                aria-live="polite"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Load JavaScript -->
    <script src="./js/skills.js" defer></script>
    <script src="./js/features.js" defer></script>
    <script src="./js/spells.js" defer></script>
    <script src="./js/equipment.js" defer></script>
    <script src="./js/attacks.js" defer></script>
    <script src="./js/dice.js" defer></script>
    <script src="./js/character-portrait.js" defer></script>
    <script src="./js/character-data.js" defer></script>
    <script src="./js/main.js" defer></script>
  </body>
</html>
